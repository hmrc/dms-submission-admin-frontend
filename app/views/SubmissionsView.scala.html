@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import java.time.LocalDate
@import java.time.LocalDateTime
@import java.time.ZoneOffset

@this(
        layout: templates.Layout
)

@(service: String, submissions: Seq[SubmissionSummary], status: Option[SubmissionItemStatus], created: Option[LocalDate])(implicit request: Request[_], messages: Messages)

  @pageLayout(contentBlock: Html) = {
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-full">
      @contentBlock
      </div>
    </div>
  }

  @layout(
    pageTitle = titleNoForm(messages("submissions.title", service)),
    pageLayout = pageLayout
  ) {

    <h1 class="govuk-heading-l">
      @messages("submissions.heading", service)
    </h1>

    @if(List(status, created).flatten.nonEmpty) {
      <h2 class="govuk-heading-s">
      @messages("submissions.filters")
      </h2>
      <ul class="govuk-list govuk-list--bullet">
        @status.map { status =>
          <li>@messages("submissions.filter.status", status)</li>
        }
        @created.map { created =>
          <li>@messages("submissions.filter.created", date(created))</li>
        }
      </ul>
    }

    @if(submissions.nonEmpty) {
      <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th class="govuk-table__header" scope="col">@messages("submissions.id")</th>
            @if(created.isEmpty) {
              <th class="govuk-table__header" scope="col">@messages("submissions.status")</th>
            }
            @if(submissions.exists(_.failureReason.isDefined)) {
              <th class="govuk-table__header" scope="col">@messages("submissions.failureReason")</th>
            }
            <th class="govuk-table__header" scope="col">@messages("submissions.lastUpdated")</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          @submissions.map { submission =>
            <tr class="govuk-table__row">
              <th class="govuk-table__header" scope="row"><code class="govuk-!-font-size-16">@submission.id</code></th>
              @if(created.isEmpty) {
                <th class="govuk-table__header" scope="row">@submission.status</th>
              }
              @if(submissions.exists(_.failureReason.isDefined)) {
                <td class="govuk-table__cell">@submission.failureReason</td>
              }
              <td class="govuk-table__cell">@dateTime(LocalDateTime.ofInstant(submission.lastUpdated, ZoneOffset.UTC))</td>
            </tr>
          }
        </tbody>
      </table>
    } else {
      <p class="govuk-body">@messages("submissions.none")</p>
    }
  }
